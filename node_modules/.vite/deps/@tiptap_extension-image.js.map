{
  "version": 3,
  "sources": ["../../@tiptap/extension-image/src/image.ts", "../../@tiptap/extension-image/src/index.ts"],
  "sourcesContent": ["import { mergeAttributes, Node, nodeInputRule, ResizableNodeView } from '@tiptap/core'\nimport type { ResizableNodeViewDirection } from 'packages/core/src/lib'\n\nexport interface ImageOptions {\n  /**\n   * Controls if the image node should be inline or not.\n   * @default false\n   * @example true\n   */\n  inline: boolean\n\n  /**\n   * Controls if base64 images are allowed. Enable this if you want to allow\n   * base64 image urls in the `src` attribute.\n   * @default false\n   * @example true\n   */\n  allowBase64: boolean\n\n  /**\n   * HTML attributes to add to the image element.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * Controls if the image should be resizable and how the resize is configured.\n   * @default false\n   * @example { directions: { top: true, right: true, bottom: true, left: true, topLeft: true, topRight: true, bottomLeft: true, bottomRight: true }, minWidth: 100, minHeight: 100 }\n   */\n  resize:\n    | {\n        enabled: boolean\n        directions?: ResizableNodeViewDirection[]\n        minWidth?: number\n        minHeight?: number\n        alwaysPreserveAspectRatio?: boolean\n      }\n    | false\n}\n\nexport interface SetImageOptions {\n  src: string\n  alt?: string\n  title?: string\n  width?: number\n  height?: number\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    image: {\n      /**\n       * Add an image\n       * @param options The image attributes\n       * @example\n       * editor\n       *   .commands\n       *   .setImage({ src: 'https://tiptap.dev/logo.png', alt: 'tiptap', title: 'tiptap logo' })\n       */\n      setImage: (options: SetImageOptions) => ReturnType\n    }\n  }\n}\n\n/**\n * Matches an image to a ![image](src \"title\") on input.\n */\nexport const inputRegex = /(?:^|\\s)(!\\[(.+|:?)]\\((\\S+)(?:(?:\\s+)[\"'](\\S+)[\"'])?\\))$/\n\n/**\n * This extension allows you to insert images.\n * @see https://www.tiptap.dev/api/nodes/image\n */\nexport const Image = Node.create<ImageOptions>({\n  name: 'image',\n\n  addOptions() {\n    return {\n      inline: false,\n      allowBase64: false,\n      HTMLAttributes: {},\n      resize: false,\n    }\n  },\n\n  inline() {\n    return this.options.inline\n  },\n\n  group() {\n    return this.options.inline ? 'inline' : 'block'\n  },\n\n  draggable: true,\n\n  addAttributes() {\n    return {\n      src: {\n        default: null,\n      },\n      alt: {\n        default: null,\n      },\n      title: {\n        default: null,\n      },\n      width: {\n        default: null,\n      },\n      height: {\n        default: null,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: this.options.allowBase64 ? 'img[src]' : 'img[src]:not([src^=\"data:\"])',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['img', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes)]\n  },\n\n  parseMarkdown: (token, helpers) => {\n    return helpers.createNode('image', {\n      src: token.href,\n      title: token.title,\n      alt: token.text,\n    })\n  },\n\n  renderMarkdown: node => {\n    const src = node.attrs?.src ?? ''\n    const alt = node.attrs?.alt ?? ''\n    const title = node.attrs?.title ?? ''\n\n    return title ? `![${alt}](${src} \"${title}\")` : `![${alt}](${src})`\n  },\n\n  addNodeView() {\n    if (\n      !this.options.resize ||\n      !this.options.resize.enabled ||\n      typeof document === 'undefined' ||\n      !this.editor.isEditable\n    ) {\n      return null\n    }\n\n    const { directions, minWidth, minHeight, alwaysPreserveAspectRatio } = this.options.resize\n\n    return ({ node, getPos, HTMLAttributes }) => {\n      const el = document.createElement('img')\n\n      Object.entries(HTMLAttributes).forEach(([key, value]) => {\n        if (value != null) {\n          switch (key) {\n            case 'width':\n            case 'height':\n              break\n            default:\n              el.setAttribute(key, value)\n              break\n          }\n        }\n      })\n\n      el.src = HTMLAttributes.src\n\n      const nodeView = new ResizableNodeView({\n        element: el,\n        node,\n        getPos,\n        onResize: (width, height) => {\n          el.style.width = `${width}px`\n          el.style.height = `${height}px`\n        },\n        onCommit: (width, height) => {\n          const pos = getPos()\n          if (pos === undefined) {\n            return\n          }\n\n          this.editor\n            .chain()\n            .setNodeSelection(pos)\n            .updateAttributes(this.name, {\n              width,\n              height,\n            })\n            .run()\n        },\n        onUpdate: (updatedNode, _decorations, _innerDecorations) => {\n          if (updatedNode.type !== node.type) {\n            return false\n          }\n\n          return true\n        },\n        options: {\n          directions,\n          min: {\n            width: minWidth,\n            height: minHeight,\n          },\n          preserveAspectRatio: alwaysPreserveAspectRatio === true,\n        },\n      })\n\n      const dom = nodeView.dom as HTMLElement\n\n      // when image is loaded, show the node view to get the correct dimensions\n      dom.style.visibility = 'hidden'\n      dom.style.pointerEvents = 'none'\n      el.onload = () => {\n        dom.style.visibility = ''\n        dom.style.pointerEvents = ''\n      }\n\n      return nodeView\n    }\n  },\n\n  addCommands() {\n    return {\n      setImage:\n        options =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: options,\n          })\n        },\n    }\n  },\n\n  addInputRules() {\n    return [\n      nodeInputRule({\n        find: inputRegex,\n        type: this.type,\n        getAttributes: match => {\n          const [, , alt, src, title] = match\n\n          return { src, alt, title }\n        },\n      }),\n    ]\n  },\n})\n", "import { Image } from './image.js'\n\nexport * from './image.js'\n\nexport default Image\n"],
  "mappings": "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",
  "names": []
}
